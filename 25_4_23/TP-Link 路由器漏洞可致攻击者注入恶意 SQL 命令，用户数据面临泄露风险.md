# Google Cloud Platform 漏洞“Confused Composer”深度分析

## 一、事件概述

    近日，Tenable Research 披露了 Google Cloud Platform（GCP）中一个已被修复的严重权限提升漏洞，代号为“Confused Composer”。该漏洞存在于 GCP 的 Cloud Composer 服务中，攻击者可通过利用 composer.environments.update 权限，注入恶意 PyPI 软件包，进而在 Cloud Build 环境中执行任意代码，最终获取高权限默认服务账号的控制权。尽管 Google 已采取措施修复该漏洞，并计划在2025年4月前完成所有实例的更新，但这一事件凸显了云服务权限配置的复杂性和潜在安全风险，值得深入分析与探讨。

## 二、事件描述分析

    “Confused Composer”漏洞的核心在于 Google Cloud Platform 中 Cloud Composer 与 Cloud Build 服务之间的交互方式存在权限管理隐患。Cloud Composer 是一种基于 Apache Airflow 的托管工作流编排服务，用于调度和自动化数据管道，而 Cloud Build 则是一项持续集成与持续交付（CI/CD）服务，用于构建、测试和部署应用程序。这两项服务在功能上高度关联，Cloud Composer 依赖 Cloud Build 来构建软件包，而这一流程恰恰成为攻击者权限提升的突破口。

    具体而言，该漏洞的成因源于 Cloud Composer 在处理用户指定的自定义 PyPI 软件包时的权限分配问题。正常的操作流程是：用户通过 Cloud Composer 环境安装自定义 Python 软件包，Composer 会启动一个构建过程，并自动配置一个 Cloud Build 实例。而这一实例默认使用的是 Cloud Build 服务账号，该账号被赋予了广泛的权限，包括对 Cloud Build 本身、Cloud Storage 以及 Artifact Registry 等资源的访问能力。然而，问题在于，任何具备 composer.environments.update 权限的用户都可以编辑 Composer 环境配置，并通过注入恶意 PyPI 软件包，利用 Cloud Build 的构建过程执行任意代码。

    攻击路径如下：首先，攻击者在 Composer 环境中指定一个恶意的 PyPI 软件包；其次，Cloud Build 在构建过程中使用 Pip 工具安装该软件包，而 Pip 会自动运行软件包的安装前和安装后脚本；最后，攻击者通过这些脚本注入代码，访问 Cloud Build 的元数据 API，提取默认服务账号的令牌，从而获得高权限账号的控制权。Tenable Research 报告特别指出，这种攻击的危险性在于，攻击者无需直接访问 Composer 或 Cloud Build 的服务账号，仅通过更新 Composer 环境的权限即可实现项目级别的完全控制。

    这一漏洞属于更广泛的“混淆函数（Confused Function）”攻击类型 Jenga 的一个变种。所谓“混淆函数”攻击，是指利用云服务权限配置中隐蔽的错误，将访问权限提升至超出预期范围的行为。报告中强调，Cloud Build 默认服务账号的权限范围过大，是导致本次漏洞严重性的直接原因。此外，这一事件也揭示了云服务之间复杂的依赖关系和权限交互，可能在设计时未被充分考虑的安全隐患。

    值得注意的是，Google 已经对此漏洞进行了修复。修复措施主要包括调整 Composer 在执行 PyPI 模块安装时的服务账号使用规则。过去，Composer 在更新操作期间使用的是权限较高的 Cloud Build 服务账号；而现在，Composer 改用权限受限的 Composer 环境服务账号进行这些操作，从而降低了被攻击的风险。新创建的 Composer 实例已应用此修复措施，而现有实例的更新则计划于2025年4月前完成。此外，Google 还更新了 Cloud Composer 的官方文档，增加了访问控制、Python 依赖项安装以及 Airflow CLI 访问等方面的安全指引，以帮助用户更好地管理相关风险。

    尽管漏洞已被修补，但其背后的权限管理问题并非个例。云服务的高集成性和复杂性使得权限分配和交互逻辑成为安全管理的难点。攻击者能够通过看似低权限的操作（如更新环境配置）实现高权限的访问，反映了当前云安全模型在设计和实施过程中可能存在的普遍性问题。此外，Tenable Research 的发现也提醒我们，第三方软件包（如 PyPI 软件包）在云环境中的安全性问题不容忽视。攻击者通过软件包的脚本执行功能实现代码注入，实际上利用的是供应链攻击的思路，这进一步增加了云服务的安全隐患。

    总的来说，“Confused Composer”漏洞不仅是技术层面的权限配置失误，更是对云服务安全设计理念的一次深刻挑战。它揭示了云环境中服务间依赖关系的潜在风险，以及权限最小化原则在实际应用中的不足。这一事件的披露和修复，固然是云安全领域的一次进步，但也为行业敲响了警钟，迫使我们重新审视云服务权限管理、供应链安全以及攻击路径防御的现状与挑战。

## 三、对我国（中国）影响分析研判

    “Confused Composer”漏洞虽然发生在 Google Cloud Platform 上，且已由 Google 修复，但其对中国的潜在影响仍需引起高度重视。随着中国企业数字化转型的加速，越来越多的组织选择将业务迁移至云端，Google Cloud Platform 作为全球领先的云服务提供商之一，在中国市场虽不及阿里云、腾讯云等本土厂商占据主导地位，但仍有大量跨国企业和研发团队依赖其服务，尤其是在全球化业务布局中。因此，这一漏洞可能对部分中国用户产生直接或间接的影响。

    首先，从直接影响来看，使用 Google Cloud Platform 的中国企业或开发者，若其业务依赖 Cloud Composer 和 Cloud Build 服务，可能在漏洞修复前面临安全风险。尽管 Google 已经对新实例应用了修复措施，但现有实例的更新时间表延续至2025年4月，这意味着部分用户仍可能处于暴露状态。对于涉及敏感数据或关键业务的中国企业而言，若未能及时了解漏洞详情并采取临时防护措施，其云端资产可能面临被攻击者利用的风险，例如数据泄露、业务中断甚至项目层面的权限失控。此外，由于漏洞允许攻击者通过低权限操作实现高权限访问，这种特性可能被某些针对性攻击（APT）团伙利用，进一步加剧安全威胁。

    其次，从间接影响来看，“Confused Composer”漏洞揭示的云服务权限管理问题具有普遍性，对中国云服务市场和发展方向具有警示作用。当前，中国的云服务市场正在快速发展，阿里云、腾讯云、华为云等本土厂商在技术架构上与国际厂商存在一定的相似性，尤其是在服务间依赖关系和权限分配的设计上，可能也面临类似的安全隐患。例如，国内云服务中普遍存在的 CI/CD 工具和工作流编排服务，若权限配置不当，同样可能成为攻击者权限提升的突破口。因此，这一事件为中国云服务提供商敲响了警钟，需重新审视自身权限管理体系的安全性，并加强对服务交互的安全审计。

    此外，这一漏洞还暴露了供应链攻击在云环境中的潜在威胁。攻击者利用 PyPI 软件包的脚本执行功能实现恶意代码注入，实际上是对云环境中第三方依赖的安全性提出了挑战。在中国，开发者同样广泛使用开源软件包和第三方工具，而这些资源的潜在风险往往被忽视。若类似漏洞出现在国内云服务或开发者生态中，可能引发更大范围的安全问题，尤其是在关键行业（如金融、医疗、能源）中，后果可能不堪设想。

    从更广泛的角度看，“Confused Composer”漏洞的披露也可能对中国云服务用户的信任和行为产生一定影响。尽管 Google 及时修复了漏洞并更新了安全文档，但事件本身可能引发用户对云服务安全性的担忧，尤其是在数据主权和隐私保护问题愈发突出的背景下。部分中国企业可能因此重新评估对国际云服务提供商的依赖程度，转而选择本土云服务商，以降低潜在的安全风险和合规压力。这种趋势可能进一步推动国内云服务市场的竞争和技术创新，但同时也可能导致企业在选择云服务时的决策成本增加。

    最后，考虑到中国在全球网络安全领域的战略地位，“Confused Composer”漏洞的披露还可能引发监管层面的关注。近年来，中国政府持续加强对数据安全和网络安全的立法与监管，《数据安全法》《个人信息保护法》等法规的实施，体现了国家对云计算安全的高度重视。此类国际云服务漏洞事件，可能促使相关部门进一步加强对云服务提供商的安全合规要求，尤其是在跨国企业使用国际云服务时的权限管理和安全审计方面。这对中国企业的云服务采购和使用策略，乃至整个云服务行业的监管环境，都可能带来深远影响。

    综上所述，尽管“Confused Composer”漏洞的直接影响可能局限于特定用户群体，但其背后反映的权限管理、安全设计和供应链风险等问题，具有普遍性警示意义。对中国而言，这一事件不仅是技术层面的安全提醒，更是推动云服务产业安全发展、加强自主可控能力的重要契机。

## 四、应对策略

    针对“Confused Composer”漏洞及其潜在影响，中国相关各方需要在技术、管理和政策层面采取综合应对策略，以降低类似风险的发生概率，并提升云服务整体安全水平。以下从企业用户、云服务提供商和监管机构三个维度提出具体建议。

    对于企业用户而言，首先需加强对云服务使用中权限管理的重视。对于使用 Google Cloud Platform 或其他国际云服务的中国企业，应立即检查自身 Composer 实例的状态，确保已应用最新的安全修复措施。对于尚未更新的实例，可临时限制 composer.environments.update 权限的使用范围，仅授权给必要人员，并加强对相关操作的监控和审计。其次，企业应建立完善的云服务安全管理机制，包括定期对云环境中使用的第三方软件包进行安全审查，避免潜在的供应链攻击风险。此外，建议企业在选择云服务时，优先考虑权限最小化原则，避免默认配置中的高权限账号被滥用，同时加强对云服务日志的分析，及时发现异常行为。最后，企业可考虑多元化云服务策略，避免过度依赖单一提供商，通过多云架构降低单一漏洞导致的系统性风险。

    对于云服务提供商而言，需从技术设计和安全管理两方面入手，强化服务安全保障能力。首先，应深入分析“Confused Composer”漏洞的技术成因，检查自身服务中是否存在类似的服务交互和权限配置问题，尤其是在 CI/CD 工具和工作流编排服务中，确保权限分配符合最小化原则，避免高权限服务账号的无必要暴露。其次，提供商应加强供应链安全管理，对用户上传或使用的第三方软件包进行严格的安全扫描和隔离执行，防止恶意代码通过软件包脚本等方式注入系统。此外，提供商还需完善安全响应机制，建立快速漏洞披露和修复流程，确保用户在漏洞曝光后能及时获得修复支持，同时通过文档更新和用户培训等方式，提升用户的安全意识和操作规范。最后，国内云服务商可借此机会加强自主研发能力，优化权限管理和安全审计工具，推动云服务安全技术的国产化进程。

    对于监管机构而言，需进一步完善云计算安全监管框架，推动行业规范化发展。首先，可参考国际云服务漏洞案例，针对权限提升、供应链攻击等高危风险，制定更具针对性的安全标准和合规要求，督促云服务提供商落实安全责任。其次，加强对跨国云服务使用的监管，特别是在涉及关键行业和敏感数据时，要求企业进行安全评估和备案，确保数据主权和用户隐私得到有效保护。此外，监管部门可推动云安全技术的研究与应用，支持产学研合作，加速云服务安全解决方案的研发和推广，为行业提供技术支撑。最后，可通过政策引导，鼓励企业优先选择安全合规的本土云服务商，增强国内云服务市场的竞争力和安全保障能力。

    需要强调的是，应对云服务安全风险不是单一主体的责任，而是需要企业、提供商和监管机构协同作战的系统工程。企业用户需提升自身安全管理和风险意识，提供商需承担技术保障和漏洞修复的主体责任，而监管机构则需通过政策制定和行业引导，提供宏观支持。只有三方形成合力，才能有效应对云服务安全挑战，保障数字化转型的安全性和可持续性。

## 五、结论

    “Confused Composer”漏洞的披露和修复，是云服务安全领域的一次重要事件。尽管 Google Cloud Platform 已及时采取措施修复该漏洞，并计划在2025年4月前完成所有实例的更新，但事件本身揭示了云服务权限管理、供应链安全及服务交互设计中的深层问题。漏洞不仅可能对部分中国用户造成直接安全威胁，更对国内云服务市场和安全发展具有深刻的警示意义。从技术层面看，权限最小化原则的落实、供应链风险的管控仍是云安全管理的重点；从行业层面看，类似事件可能影响用户对云服务的信任，促使企业重新审视云服务选择和安全策略。

    通过对事件的分析和影响研判，可以看出，云服务安全不仅是技术问题，更是管理、政策和信任等多维度交织的综合挑战。对此，中国企业、云服务提供商和监管机构需通力合作，共同应对潜在风险。企业应加强权限管理和安全审查，提供商需优化技术设计和漏洞响应机制，而监管部门则需完善政策框架和行业标准。只有多方协同，才能构建更加安全、可靠的云服务生态，为数字化经济的持续发展保驾护航。

**出处来源：Tenable Research**