 # 恶意RubyGems包伪装成Fastlane插件窃取Telegram数据的供应链攻击分析

## 一、事件概述

近期，安全研究机构Socket发现两个恶意RubyGems软件包通过伪装成流行的Fastlane CI/CD插件，将Telegram API请求重定向至攻击者控制的服务器，从而拦截和窃取敏感数据。这些恶意包已在RubyGems平台上积累了数百次下载，受害开发者的Telegram bot令牌、消息数据、文件和代理凭证可能已被泄露，对使用这些包的开发环境和应用程序安全构成严重威胁。

## 二、事件描述分析

### 攻击手法详解

本次攻击是一起典型的供应链攻击，攻击者通过在官方包管理平台RubyGems上发布伪装成合法插件的恶意软件包，利用开发者对官方渠道的信任实施攻击。这两个恶意包分别是：

- fastlane-plugin-telegram-proxy：发布于2025年5月30日，已有287次下载
- fastlane-plugin-proxy_teleram：发布于2025年5月24日，已有133次下载

这些恶意包采用了"typosquatting"（拼写变形）技术，通过使用与合法包相似但略有不同的名称来欺骗开发者。它们伪装成Fastlane的Telegram通知插件，几乎完全复制了合法插件的公共API、自述文件、文档和核心功能，使得开发者难以察觉异常。

### 技术细节

恶意包的关键区别在于将合法的Telegram API端点（https://api.telegram.org/）替换为攻击者控制的代理端点（粗糙微风-0c37[.]buidanhnam95[.]workers[.]dev）。当开发者使用这些恶意包发送Telegram通知时，所有数据都会经过攻击者的服务器，使攻击者能够拦截和窃取以下敏感信息：

1. Telegram bot令牌
2. 聊天ID和消息内容
3. 通过Telegram发送的任何附件文件
4. 配置的代理凭证

特别值得注意的是，这些bot令牌在开发者主动撤销前将持续有效，给攻击者提供了长期利用的机会。

### 攻击者的隐蔽手段

攻击者使用了Cloudflare Workers来托管他们的代理服务，这使得其恶意代码不对外可见。虽然攻击者在包描述中声称"不会存储或修改您的bot令牌"，但Socket研究人员指出，实际上无法验证这一说法，攻击者保留了"记录、检查或修改传输中任何数据的全部能力"。

### 影响范围

基于下载次数统计，至少有420个开发环境可能受到影响。考虑到Fastlane主要用于移动应用开发的CI/CD流程，这些恶意包可能已经影响了多个移动应用项目。受影响的开发者不仅面临Telegram通信数据泄露的风险，还可能导致其构建和部署的应用程序安全性受到威胁。

## 三、对中国影响分析研判

### 国内开发生态影响

虽然RubyGems在中国的使用率不如npm或PyPI广泛，但随着移动应用开发的全球化，许多中国开发团队也采用了国际主流的CI/CD工具链，包括Fastlane。特别是：

1. **跨国开发团队**：在中国设有研发中心的跨国公司，以及面向海外市场的中国互联网企业，往往采用国际通用的开发工具链，这些团队可能直接受到影响。

2. **移动应用开发商**：中国是全球最大的移动应用开发市场之一，众多开发者使用自动化工具提高效率，Fastlane作为知名工具可能被广泛采用。

3. **开源社区参与者**：活跃在国际开源社区的中国开发者可能直接使用RubyGems平台上的包。

### 安全风险评估

对中国开发者和企业的具体安全风险包括：

1. **数据泄露风险**：如果开发团队使用Telegram进行工作沟通，且采用了这些恶意包，团队内部通信、项目进度、甚至源代码片段可能被泄露。

2. **应用安全风险**：如果被攻击的CI/CD环境用于构建正式发布的应用，攻击者理论上可能有机会在构建过程中植入后门。

3. **知识产权风险**：研发过程中的敏感信息如被泄露，可能导致知识产权泄露。

4. **供应链连锁反应**：这类攻击的影响可能沿供应链传递，影响依赖受感染包的下游项目。

### 监管合规考量

随着《数据安全法》《个人信息保护法》和《网络安全法》等法规的实施，中国企业面临更严格的数据安全合规要求。使用被感染的开发工具可能导致企业无意中违反相关法规，尤其是当这些工具处理敏感数据或个人信息时。

## 四、应对策略

### 立即响应措施

对于可能使用了这些恶意包的开发团队，建议采取以下紧急措施：

1. **移除恶意包**：立即从开发环境中删除这两个恶意gem包。

2. **重新构建应用**：重新构建所有在安装恶意包后生成的移动应用二进制文件，确保最终产品不受影响。

3. **轮换凭证**：立即撤销并更新所有与Fastlane一起使用的Telegram bot令牌，视情况还应更新其他可能被泄露的凭证。

4. **安全审计**：对构建环境和构建产物进行全面安全审计，检查是否存在其他安全问题。

### 长期防护策略

为防止类似供应链攻击，建议中国开发团队和企业采取以下长期措施：

1. **包验证机制**：在CI/CD流程中引入软件包完整性验证机制，如使用锁文件（lockfile）锁定依赖版本，并验证包的哈希值。

2. **建立私有包仓库**：考虑建立企业内部的私有包仓库，对外部包进行安全审核后再纳入内部使用。

3. **自动化安全扫描**：在开发流程中集成自动化的依赖项安全扫描工具，如OWASP Dependency-Check、Snyk或国内的相关工具。

4. **最小权限原则**：确保CI/CD流程中使用的各类凭证遵循最小权限原则，减少单点泄露可能造成的影响范围。

5. **开发者安全培训**：加强对开发人员的安全意识培训，特别是关于供应链安全和第三方依赖管理的知识。

### 行业协作建议

1. **信息共享机制**：鼓励企业参与国内外的安全信息共享平台，及时获取和分享供应链攻击情报。

2. **开源安全合作**：积极参与开源安全社区，共同提高开源生态的安全性。

3. **本地化安全工具**：支持国内安全厂商开发适合中国开发环境的供应链安全工具。

## 五、结论

本次RubyGems平台上的恶意包事件反映了软件供应链安全问题的持续严峻性。攻击者通过精心伪装的软件包，利用开发者对官方渠道的信任，实现了对敏感数据的窃取。这种攻击手法隐蔽性强、影响范围广、持续时间长，对软件开发生态构成了严重威胁。

对中国开发者和企业而言，这一事件提醒我们需要重新审视开发环境的安全性，特别是对第三方依赖的管理和验证机制。随着软件开发全球化和国内数字经济的快速发展，供应链安全将成为保障数字基础设施安全的关键环节。

从长远来看，解决供应链安全问题需要技术手段与管理措施并重，包括完善的包验证机制、安全扫描工具、开发者安全意识培训，以及行业内的情报共享与合作。只有构建起多层次的防护体系，才能有效应对日益复杂的供应链攻击威胁，保障中国数字经济的健康发展。